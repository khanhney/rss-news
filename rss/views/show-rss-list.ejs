

<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,minimal-ui">
      <title>Blockchain-HUB</title>
      <meta content="Admin Dashboard" name="description">
      <meta content="Themesbrand" name="author">
      <link rel="shortcut icon" href="/vertical/assets/images/favicon.ico">
      <link href="/vertical/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
      <link href="/vertical/assets/css/metismenu.min.css" rel="stylesheet" type="text/css">
      <link href="/vertical/assets/css/icons.css" rel="stylesheet" type="text/css">
      <link href="/vertical/assets/css/style.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

   </head>
   <body>
      <!-- Begin page -->
      <div id="wrapper">
        <!-- Top Bar Start -->
        <div class="topbar">
                <!-- LOGO -->
                <div class="topbar-left">
                    <!-- <a href="index.html" class="logo"><span><img src="/vertical/assets/images/logo-light.png" alt="" height="18"> </span><i>
                        <img src="/vertical/assets/images/logo-sm.png" alt="" height="22"></i></a> -->
                </div>
                <nav class="navbar-custom">
                    <ul class="navbar-right d-flex list-inline float-right mb-0">
                        <li class="dropdown notification-list d-none d-sm-block">
                            <form role="search" class="app-search">
                                <div class="form-group mb-0">
                                    <input type="text" class="form-control" placeholder="Search..">
                                    <button type="submit"><i class="fa fa-search"></i></button>
                                </div>
                            </form>
                        </li>
                        <li class="dropdown notification-list"><a class="nav-link dropdown-toggle arrow-none waves-effect" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false"><i class="ti-bell noti-icon"></i> <span class="badge badge-pill badge-danger noti-icon-badge">3</span></a>
                            <div class="dropdown-menu dropdown-menu-right dropdown-menu-lg">
                                <!-- item-->
                                <h6 class="dropdown-item-text">Notifications (258)</h6>
                                <div class="slimscroll notification-item-list">
                                    <!-- item-->
                                    <a href="javascript:void(0);" class="dropdown-item notify-item active">
                                        <div class="notify-icon bg-success"><i class="mdi mdi-cart-outline"></i></div>
                                        <p class="notify-details">Your order is placed<span class="text-muted">Dummy text of the printing and typesetting industry.</span></p>
                                    </a>
                                    <!-- item-->
                                    <a href="javascript:void(0);" class="dropdown-item notify-item">
                                        <div class="notify-icon bg-warning"><i class="mdi mdi-message"></i></div>
                                        <p class="notify-details">New Message received<span class="text-muted">You have 87 unread messages</span></p>
                                    </a>
                                    <!-- item-->
                                    <a href="javascript:void(0);" class="dropdown-item notify-item">
                                        <div class="notify-icon bg-info"><i class="mdi mdi-martini"></i></div>
                                        <p class="notify-details">Your item is shipped<span class="text-muted">It is a long established fact that a reader will</span></p>
                                    </a>
                                    <!-- item-->
                                    <a href="javascript:void(0);" class="dropdown-item notify-item">
                                        <div class="notify-icon bg-primary"><i class="mdi mdi-cart-outline"></i></div>
                                        <p class="notify-details">Your order is placed<span class="text-muted">Dummy text of the printing and typesetting industry.</span></p>
                                    </a>
                                    <!-- item-->
                                    <a href="javascript:void(0);" class="dropdown-item notify-item">
                                        <div class="notify-icon bg-danger"><i class="mdi mdi-message"></i></div>
                                        <p class="notify-details">New Message received<span class="text-muted">You have 87 unread messages</span></p>
                                    </a>
                                </div>
                                <!-- All--><a href="javascript:void(0);" class="dropdown-item text-center text-primary">View all <i class="fi-arrow-right"></i></a></div>
                        </li>
                        <li class="dropdown notification-list">
                            <div class="dropdown notification-list nav-pro-img">
                                <a class="dropdown-toggle nav-link arrow-none waves-effect nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false"><img src="/vertical/assets/images/users/user-4.jpg" alt="user" class="rounded-circle"></a>
                                <div class="dropdown-menu dropdown-menu-right profile-dropdown">
                                    <!-- item--><a class="dropdown-item" href="#"><i class="mdi mdi-account-circle m-r-5"></i> Profile</a> <a class="dropdown-item" href="#"><i class="mdi mdi-wallet m-r-5"></i> My Wallet</a> <a class="dropdown-item d-block" href="#"><span class="badge badge-success float-right">11</span><i class="mdi mdi-settings m-r-5"></i> Settings</a> <a class="dropdown-item" href="#"><i class="mdi mdi-lock-open-outline m-r-5"></i> Lock screen</a>
                                    <div class="dropdown-divider"></div><a class="dropdown-item text-danger" href="#"><i class="mdi mdi-power text-danger"></i> Logout</a></div>
                            </div>
                        </li>
                    </ul>
                    <ul class="list-inline menu-left mb-0">
                        <li class="float-left">
                            <button class="button-menu-mobile open-left waves-effect"><i class="mdi mdi-menu"></i></button>
                        </li>
                        <li class="d-none d-sm-block">
                            <div class="dropdown pt-3 d-inline-block"><a class="btn btn-light dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Create</a>
                                <div class="dropdown-menu" aria-labelledby="dropdownMenuLink"><a class="dropdown-item" href="#">Action</a> <a class="dropdown-item" href="#">Another action</a> <a class="dropdown-item" href="#">Something else here</a>
                                    <div class="dropdown-divider"></div><a class="dropdown-item" href="#">Separated link</a></div>
                            </div>
                        </li>
                    </ul>
                </nav>
        </div>
        <!-- Top Bar End -->
        <!-- ========== Left Sidebar Start ========== -->
        <div class="left side-menu">
            <div class="slimscroll-menu" id="remove-scroll">
                <!--- Sidemenu -->
                <div id="sidebar-menu">
                    <!-- Left Menu Start -->
                    <ul class="metismenu" id="side-menu">
                        <li class="menu-title">Quản Lý</li>
                        <li>
                            <a href="javascript:void(0);" class="waves-effect"><i class="mdi mdi-hospital-building"></i><span> RSS - Data <span class="float-right menu-arrow"><i class="mdi mdi-chevron-right"></i></span></span></a>
                            <ul class="submenu">
                                <li><a href="/danh-sach-ho-so">Danh Sách Item</a></li>
                                <li><a href="/tim-kiem">Tìm Kiếm - Lưu Trữ</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <!-- Sidebar -->
                <div class="clearfix"></div>
            </div>
            <!-- Sidebar -left -->
        </div>
         <!-- Left Sidebar End --><!-- ============================================================== --><!-- Start right Content here --><!-- ============================================================== -->
         <div class="content-page">
            <!-- Start content -->
            <div class="content">
               <div class="container-fluid">
                  <!-- end row -->
                  <div class="row">
                     <!-- end col -->
                     <div class="col-lg-12">
                        <div class="card m-b-20">
                           <div class="card-body">
                              <div class="row">
                                  <div class="col-md-10">
                                        <h4 class="mt-0 header-title">Danh Sách ITEM RSS</h4>
                                  </div>
                                  <div class="col-md-2">
                                      <a href="/tao-ho-so">
                                        <button type="button" class="btn btn-outline-dark waves-effect waves-light">Hồ Sơ Mới</button>
                                      </a>
                                  </div>
                              </div>
                              <p class="text-muted m-b-30">Danh Sách.</p>
                              <table class="table table-dark mb-0">
                                 <thead>
                                    <tr>
                                       <th>#</th>
                                       <th>Tiêu Đề</th>
                                       <th>Trạng Thái</th>
                                       <th>Link</th>
                                       <th>Nội Dung</th>
                                       <th>Ngày Đăng</th>
                                       <th>***</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <% var flag = 1; %>
                                    <%LIST_DATA_RSS.forEach(item => {%>
                                        <tr>
                                            <th scope="row"><%= flag %></th>
                                            <td><%= item.title %></td>
                                            <td>
                                                    <span class="badge badge-pill badge-success">Đang Hoạt Động</span>
                                            </td>
                                            
                                            <td>
                                                <a href="<%= item.link%>" target="blank"  data-toggle="tooltip" data-placement="right" title="" data-original-title="Xem Chi tiết"><%= item.link%></a>
                                            </td>

                                            <td><%= item.contentSnippet.substring(0, 30)%> ..</td>

                                            <% var convertTime = moment(item.isoDate).subtract(10, 'days').calendar(); %>
                                            <td><%= convertTime%></td>

                                            <td style="cursor: pointer;">
                                                <span data-toggle="modal" data-target=".bs-example-modal-lg-2" _id='<%= item._id%>' class="btnEdit">
                                                    <i class="mdi mdi-lead-pencil" style=" font-size: 22px;" data-toggle="tooltip" data-placement="right" title="" data-original-title="Cập Nhật Feed"></i>
                                                </span>

                                                <span data-toggle="modal" data-target=".bs-example-modal-lg" _id='<%= item._id%>' class="btnRemove">
                                                    <i class="mdi mdi-folder-remove" style=" font-size: 22px;" data-toggle="tooltip" data-placement="right" title="" data-original-title="Cập Nhật Trạng Thái"></i>
                                                </span>
                                            </td>
                                        </tr>
                                        <% flag++;%>
                                    <%})%>
                                   
                                 </tbody>
                              </table>
                           </div>
                        </div>
                     </div>
                     <!-- end col -->
                  </div>
               </div>
               <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title mt-0" id="myLargeModalLabel">Cập Nhật Đơn Thuốc</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            </div>
                            <div class="modal-body">
                                    <div class="card m-b-20">
                                        <div class="card-header"></div>
                                        <div class="card-body">
                                            <div class="form-group row">
                                                <label for="example-text-input" class="col-sm-2 col-form-label">Tên Đơn Thuốc</label>
                                                <div class="col-sm-10"><input class="form-control" type="text" placeholder="Đơn Thuốc ABC"" id="namePrescription"></div>
                                            </div>
                                            <div class="form-group row">
                                                <label for="example-search-input" class="col-sm-2 col-form-label">Số Lượng Chi Tiết</label>
                                                <div class="col-sm-10"><input class="form-control" type="search" placeholder="10" id="amountPrescription" ></div>
                                            </div>
                                            <div class="form-group row">
                                                <label for="example-text-input" class="col-sm-2 col-form-label">Mô Tả</label>
                                                <div class="col-sm-10"><input class="form-control" type="text" placeholder="Uống Ngày 2 lần, mỗi lần 1 viên.."" id="descriptionPrescription"></div>
                                            </div>
                                            <div class="form-group row">
                                                <label class="col-sm-2 col-form-label">Thuốc</label>
                                                <div class="col-sm-10">
                                                    <select class="form-control" id="medicineID">
                                                        <!-- RENDER WITH AJAX -->
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                    <button type="button" id="btnConfirmPrescription" class="btn btn-outline-info waves-effect waves-light pull-right" style="right: 0px; margin-right:0px">Xác Nhận</button>
                                            </div>
                                        </div>
                                    </div>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                <!-- /.modal-dialog -->
                </div>

                <div class="modal fade bs-example-modal-lg-2" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                   
                                </div>
                                <div class="modal-body">
                                   <div class="row">
                                       <div class="col-md-8">
                                            <div class="card m-b-20">
                                                    <div class="card-header"></div>
                                                    <div class="card-body">
                                                        <div class="form-group row">
                                                            <label class="col-sm-2 col-form-label">Bác Sĩ</label>
                                                            <div class="col-sm-10">
                                                                <select class="form-control" id="doctorID"">
                                                                    <!-- RENDER WITH AJAX -->
                                                                </select>
                                                            </div>
                                                        </div>

                                                    </div>
                                            </div>
                                       </div>
                                       <div class="col-md-4">
                                            <div class="card m-b-20">
                                                    <div class="card-header"></div>
                                                    <div class="card-body">
                                                        <div class="form-group row">
                                                            <div class="col-sm-10"><input class="form-control" type="text" placeholder="Tổng Tiền"" id="totalPriceTransaction"></div>
                                                        </div>
                                                        <div class="form-group row">
                                                            <div class="col-sm-10"><input class="form-control" type="text" placeholder="Lưu Ý" id="descriptionTransaction"></div>
                                                        </div>
                                                        <div class="form-group row">
                                                                <button type="button" id="btnConfirmTransaction" class="btn btn-outline-info waves-effect waves-light pull-right" style="margin-left: 30%">Xác Nhận</button>
                                                        </div>
                                                    </div>
                                            </div>
                                           
                                       </div>
                                   </div>
                                </div>
                            </div>
                            <!-- /.modal-content -->
                        </div>
                    <!-- /.modal-dialog -->
                    </div>
               <!-- container-fluid -->
            </div>
            <!-- content -->
            <footer class="footer">© 2018 Lexa - <span class="d-none d-sm-inline-block">Crafted with <i class="mdi mdi-heart text-danger"></i> by Themesbrand</span>.</footer>
         </div>
         <!-- ============================================================== --><!-- End Right content here --><!-- ============================================================== -->
      </div>
      <!-- END wrapper --><!-- jQuery  --><script src="/vertical/assets/js/jquery.min.js"></script><script src="/vertical/assets/js/bootstrap.bundle.min.js"></script><script src="/vertical/assets/js/metisMenu.min.js"></script><script src="/vertical/assets/js/jquery.slimscroll.js"></script><script src="/vertical/assets/js/waves.min.js"></script><script src="../plugins/jquery-sparkline/jquery.sparkline.min.js"></script><!-- App js --><script src="/vertical/assets/js/app.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
      <script>
          $(document).ready(function(){
              $('.btnVerifyPatientOut').on('click', function(){
                  const userID = $(this).attr('_id');
                  $.ajax({
                      url: `/xac-nhan-ipfs/${userID}`,
                      method: 'GET',
                      success: function(data) {
                          console.log({ data })
                      },
                      error: function(err) {
                          console.log(err);
                      }
                  })
              });


            //   update info event
            $('.btnUpdateDoctor').on('click', function(){
                const userID = $(this).attr('_id');

            })
            
            // set data when exist data prescription
            const setDatePrescription = (namePrescription, amountPrescription, descriptionPrescription) => {
                $('#namePrescription').val(namePrescription);
                $('#amountPrescription').val(amountPrescription);
                $('#descriptionPrescription').val(descriptionPrescription);
            }

            const getDataPrescription = () => {
                const title = $('#namePrescription').val();
                const amount = $('#amountPrescription').val();
                const description = $('#descriptionPrescription').val();
                const medicineID = $('#medicineID').val();
                
                return { title, amount, description, medicineID };
            }

            var patientID = '';
            // update prescription
            $('.btnUpdatePrescription').on('click', function(){
                patientID = $(this).attr('_id');
                    $.ajax({
                    url: `/thong-tin-don-thuoc/${patientID}`,
                    method: 'GET',
                    success: function(resp){
                        if(resp.data) {
                            return setDatePrescription(resp.title, resp.amout, resp.description);
                        }
                        return;
                    },
                    error: function(err){
                        console.log(err);
                    }
                })

                $('#btnConfirmPrescription').on('click', function(){
                    var objData = getDataPrescription();
                    objData.patientID = patientID;
                    $.ajax({
                        url: '/them-don-thuoc',
                        method: 'POST',
                        data: objData,
                        success: function(resp) {
                            if (!resp.error) {
                                $('.bs-example-modal-lg-2').modal('hide');
                                return toastr.info('Cập Nhật Đơn Thuốc Thành Công');
                            }
                            return toastr.error('Cập Nhật Đơn Thuốc Thất Bại');
                        },
                        error: function(err) {
                            console.log(err)
                        }
                    })
                })
            })

            const getDataTransaction = () => {
                const totalPrice = $('#totalPriceTransaction').val();
                const description = $('#descriptionTransaction').val();
                const doctorID = $('#doctorID').val();
                return { totalPrice, description, doctorID };
            }
            $('.btnUpdateDoctor').on('click', function(){
                patientID = $(this).attr('_id');
                
                $('#btnConfirmTransaction').on('click', function(){
                    var objData = getDataTransaction();
                    objData.patientID = patientID;
                    $.ajax({
                        url: '/cap-nhat-ho-so-giao-dich',
                        method: 'POST',
                        data: objData,
                        success: function(resp) {
                            if (!resp.error) {
                                $('.bs-example-modal-lg-2').modal('hide');
                                return toastr.info('Cập Nhật Thông Tin Thành Công');
                            }
                            return toastr.error('Cập Nhật Thông Tin Thất Bại');
                        },
                        error: function(err) {
                            console.log(err)
                        }
                    })
                })
            })

            // add select medicines
            $.ajax({
                url : '/danh-sach-thuoc',
                method: 'GET',
                success: function(resp) {
                    const listMedicines = resp.data;
                    
                    listMedicines.forEach(item => {
                        $('#medicineID').append(`
                            <option value='${item._id}'>${item.name}</option>
                        `);
                    })
                }
            })

            $.ajax({
                url : '/danh-sach-bac-si',
                method: 'GET',
                success: function(resp) {
                    const doctorList = resp.data;
                    
                    doctorList.forEach(item => {
                        $('#doctorID').append(`
                            <option value='${item._id}'>${item.fullname}</option>
                        `);
                    })
                }
            })
          });
      </script>
    </body>
</html>

